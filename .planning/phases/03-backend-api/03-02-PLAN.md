---
phase: 03-backend-api
plan: 02
type: execute
---

<objective>
Implement Stream Management Features using TDD.

Purpose: Robust implementation of Create/Stop/Join stream logic.
Output: Tested and working Stream API.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-backend-api/03-01-SUMMARY.md

**TDD Approach**:
1. Write Service Test (Fail) -> Implement Service -> Pass.
2. Write API Test (Fail) -> Implement Router -> Pass.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define Schemas</name>
  <files>backend/src/app/schemas/stream.py</files>
  <action>
    Define Pydantic models: `StreamCreate`, `StreamResponse`.
  </action>
  <verify>Import check</verify>
  <done>Schemas defined</done>
</task>

<task type="auto">
  <name>Task 2: TDD - Stream Service (Business Logic)</name>
  <files>backend/src/app/tests/test_services.py, backend/src/app/services/stream_service.py</files>
  <action>
    1. Create `backend/src/app/tests/test_services.py`.
    2. Write Test: `test_create_stream_reuses_code` (Assert failure - service doesn't exist).
    3. Write Test: `test_create_stream_generates_unique_code`.
    4. Implement `backend/src/app/services/stream_service.py`:
       - `create_stream`: Implement "Reuse Code" logic.
       - `stop_stream`: Implement status update.
       - `get_stream`: Implement fetch.
    5. Run tests until green.
  </action>
  <verify>
    cd backend && uv run pytest src/app/tests/test_services.py
  </verify>
  <done>Service logic verified independent of API</done>
</task>

<task type="auto">
  <name>Task 3: TDD - Stream API (Integration)</name>
  <files>backend/src/app/tests/test_streams_api.py, backend/src/app/api/v1/streams.py</files>
  <action>
    1. Create `backend/src/app/tests/test_streams_api.py`.
    2. Write Test: `test_create_stream` (Checking response structure).
    3. Write Test: `test_stop_stream` (Checking status update).
    4. Implement `backend/src/app/api/v1/streams.py` Router.
    5. Register router in `main.py`.
    6. Run tests until green.
  </action>
  <verify>
    cd backend && uv run pytest src/app/tests/test_streams_api.py
  </verify>
  <done>API endpoints verified</done>
</task>

</tasks>

<verification>
- [ ] `uv run pytest` passes all tests.
- [ ] Business logic (Code Reuse) is verified.
</verification>

<output>
Next: Ready for 03-03-PLAN.md (Device Auth TDD)
</output>
