---
phase: 01-foundation
plan: 03
type: execute
---

<objective>
Configure local development environment with scripts, Makefile, and Docker for streamlined developer workflow.

Purpose: Enable quick iteration cycles for backend development and standardize common commands across team members.
Output: Makefile with common commands, setup scripts, and Docker configuration for backend containerization.
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md

**Phase 1 Goal:** Set up project structure with backend (FastAPI + uv) and iOS (Tuist) scaffolding

**Prior Plans:**
- 01-01: FastAPI backend with uv (created backend/ structure)
- 01-02: iOS Tuist project (created ios/ structure)

**Tech Decisions:**
- uv for Python (requires installation check)
- Tuist for iOS (requires installation check)
- Docker for backend containerization (future deployment)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Development Scripts and Makefile</name>
  <files>Makefile, scripts/setup.sh, scripts/dev-backend.sh, README.md</files>
  <action>
    1. Create `scripts/setup.sh`:
       - Check for uv, install if missing (curl -LsSf https://astral.sh/uv/install.sh | sh)
       - Check for tuist, install if missing (curl -Ls https://install.tuist.io | bash)
       - Run `cd backend && uv sync` to install Python deps
       - Print success message with next steps
       - Make executable (chmod +x)
    
    2. Create `scripts/dev-backend.sh`:
       - cd to backend/
       - Run uvicorn with --reload flag
       - Use environment variables for host/port with defaults
       - Make executable
    
    3. Create `Makefile` at project root with targets:
       - `setup`: Run scripts/setup.sh
       - `backend-dev`: Run scripts/dev-backend.sh
       - `backend-test`: cd backend && uv run pytest
       - `ios-generate`: cd ios && tuist generate
       - `ios-build`: cd ios && tuist build
       - `ios-open`: cd ios && open StreamLive.xcworkspace
       - `clean`: Remove generated files (.venv, *.xcworkspace, etc.)
       - `help`: List all available targets with descriptions
    
    4. Update/create `README.md` with:
       - Project overview (from PROJECT.md one-liner)
       - Prerequisites (uv, tuist, Docker)
       - Quick start guide (make setup, make backend-dev)
       - Development commands table
    
    Use .PHONY for all targets.
    Use @ prefix for clean output (hide command echo).
  </action>
  <verify>
    make help  # Should list all targets
    make backend-dev &  # Should start server
    sleep 2
    curl -s http://localhost:8000/health | grep -q "ok"
    kill %1
  </verify>
  <done>Makefile works, scripts executable, README documents dev workflow</done>
</task>

<task type="auto">
  <name>Task 2: Add Docker Configuration</name>
  <files>docker-compose.yml, backend/Dockerfile, .dockerignore</files>
  <action>
    1. Create `backend/Dockerfile`:
       - Multi-stage build for smaller image
       - Stage 1 (builder): python:3.12-slim, install uv, copy pyproject.toml, uv sync
       - Stage 2 (runtime): python:3.12-slim, copy venv from builder, copy src/
       - Expose port 8000
       - CMD: uvicorn app.main:app --host 0.0.0.0 --port 8000
       - Use non-root user for security
    
    2. Create `docker-compose.yml` at project root:
       - Service: api
         - Build: ./backend
         - Ports: 8000:8000
         - Environment: STREAMLIVE_DEBUG=true
         - Volumes (for dev): ./backend/src:/app/src (optional, for hot reload)
       - Add placeholder comment for future media server service
    
    3. Create `.dockerignore`:
       - .git, .venv, __pycache__, *.pyc
       - .pytest_cache, .mypy_cache
       - ios/, scripts/, Makefile (backend-only image)
    
    4. Add Makefile targets:
       - `docker-build`: docker compose build
       - `docker-up`: docker compose up
       - `docker-down`: docker compose down
    
    Use COPY --from=builder for multi-stage.
    Do NOT include dev dependencies in production image.
  </action>
  <verify>
    docker compose build api
    docker compose up -d api
    sleep 3
    curl -s http://localhost:8000/health | grep -q "ok"
    docker compose down
  </verify>
  <done>Docker image builds, container runs, health endpoint accessible</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `make help` shows all available targets
- [ ] `make setup` runs without errors (on clean system)
- [ ] `make backend-dev` starts FastAPI server
- [ ] `docker compose up api` runs backend in container
- [ ] `curl http://localhost:8000/health` returns ok (both native and Docker)
- [ ] README documents all commands
</verification>

<success_criteria>

- Makefile provides consistent interface for all dev tasks
- Setup script handles tool installation
- Docker configuration ready for deployment
- README provides clear onboarding guide
- Phase 1 complete: backend + iOS + dev environment all working
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md` with:
- One-liner about what was built
- Files created
- Development workflow description
- Phase 1 complete declaration
- Next: Ready for Phase 2 (Media Server)

Also update `.planning/STATE.md`:
- Current Position: Phase 2
- Last activity: Phase 1 complete
- Progress: Update to reflect Phase 1 completion
</output>
